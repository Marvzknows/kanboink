generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  createdAt     DateTime       @default(now())
  first_name    String
  last_name     String
  middle_name   String?
  password      String
  updatedAt     DateTime       @updatedAt
  activeBoardId String?
  activities    ActivityLog[]
  ownedBoards   Board[]        @relation("BoardOwner")
  Card          Card[]
  cards         Card[]         @relation("CreatedCards")
  comments      Comment[]
  activeBoard   Board?         @relation(fields: [activeBoardId], references: [id])
  refreshTokens RefreshToken[]
  boards        Board[]        @relation("BoardMembers")

  @@index([activeBoardId])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

model Board {
  id         String        @id @default(cuid())
  title      String
  ownerId    String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  activities ActivityLog[]
  owner      User          @relation("BoardOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  lists      List[]
  User       User[]
  members    User[]        @relation("BoardMembers")

  @@index([ownerId])
}

model Card {
  id          String       @id @default(cuid())
  title       String
  description String?
  assigneeId  String?
  listId      String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  priority    PriorityList
  position    Int
  createdById String
  user        User?        @relation(fields: [assigneeId], references: [id], onDelete: Cascade)
  createdBy   User         @relation("CreatedCards", fields: [createdById], references: [id], onDelete: Cascade)
  list        List         @relation(fields: [listId], references: [id], onDelete: Cascade)
  comments    Comment[]

  @@index([assigneeId])
  @@index([createdById])
  @@index([listId])
}

model List {
  id        String   @id @default(cuid())
  title     String
  boardId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  position  Int
  cards     Card[]
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)

  @@index([boardId])
}

model Comment {
  id          String   @id @default(uuid())
  userId      String
  cardId      String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  card        Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([cardId])
  @@index([userId])
}

model ActivityLog {
  id        String         @id @default(uuid())
  action    ActivityAction
  details   Json?
  userId    String
  boardId   String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  board     Board?         @relation(fields: [boardId], references: [id], onDelete: Cascade)
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([boardId])
  @@index([userId])
}

enum ActivityAction {
  CARD_CREATED
  CARD_UPDATED
  CARD_MOVED
  CARD_DELETED
  BOARD_CREATED
  BOARD_UPDATED
  BOARD_DELETED
  COMMENT_ADDED
  COMMENT_DELETED
}

enum PriorityList {
  LOW
  MEDIUM
  HIGH
  URGENT
}
